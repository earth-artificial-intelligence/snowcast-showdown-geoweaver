[{
  "history_id" : "7e7g59o5coe",
  "history_input" : "import os\nos.environ[\"KMP_DUPLICATE_LIB_OK\"] = \"TRUE\"\nimport numpy as np\nimport matplotlib.pyplot as plt\nimport seaborn as sns\nimport torch\nfrom visualization.boxplot import quantized\nfrom models.inference import getests\n\ndef monthests (inputs, dates, uregions, r):\n    trg = inputs['target'][...,0]; e = trg-r\n    ok = torch.isfinite(e)\n    \n    est = {}    \n    device = inputs['yinput'].device\n    month = torch.tensor([d.month for d in dates], device=device)\n    for ireg,reg in enumerate(uregions+['others', 'all']):\n        est[reg] = {}\n        if reg in uregions:\n            region = inputs['yinput'][0,:,ireg]>0.5\n        elif reg == 'others':\n            region = inputs['yinput'][0,:,:2].sum(-1)>0.5\n        else:\n            region = torch.full(inputs['yinput'].shape[1:2], True, device=device)\n        for m in [1,2,3,4,5,6,12]:\n            est[reg][m] = getests (inputs, r, select = month==m, region=region)[2:]\n        fig, ax = plt.subplots(1,1)\n        ax.set_title(reg+' BIAS')\n        m = month[:,None].expand(-1,region.sum())[ok[:,region]].cpu().numpy()\n        sns.boxenplot(x=m, y=e[:,region][ok[:,region]].cpu().numpy(), linewidth=1.5, ax=ax)\n        fig, ax = plt.subplots(1,1)\n        ax.set_title(reg+' MAE')\n        sns.boxenplot(x=m, y=torch.abs(e[:,region][ok[:,region]]).cpu().numpy(), linewidth=1.5, ax=ax)\n    \n    fig, ax = plt.subplots(1,1)\n    ax.set_title('BIAS')\n    x,y = quantized (r[ok],e[ok],nrmy=False)\n    sns.boxenplot(x=x,y=y, linewidth=1.5, ax=ax)\n    ax.set_xlabel('forecast')\n    fig, ax = plt.subplots(1,1)\n    ax.set_title('MAE')\n    x,y = quantized (r[ok],torch.abs(e[ok]),nrmy=False)\n    sns.boxenplot(x=x,y=y, linewidth=1.5, ax=ax)\n    ax.set_xlabel('forecast')\n    # ok = torch.isfinite(e) & (torch.abs(e) < 15.)\n    # x,y = quantized (r[ok],torch.abs(e[ok]),nrmy=False)\n    # sns.boxenplot(x=x,y=y, linewidth=1.5)\n    return est",
  "history_output" : "Traceback (most recent call last):\n  File \"visualization_month.py\", line 5, in <module>\n    import seaborn as sns\nModuleNotFoundError: No module named 'seaborn'\n",
  "history_begin_time" : 1668624344215,
  "history_end_time" : 1668624347280,
  "history_notes" : null,
  "history_process" : "fs1bt1",
  "host_id" : "100001",
  "indicator" : "Done"
},]
